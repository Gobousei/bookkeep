<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <title>CashFlow Keeper</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <style>
      .loading {
    width: 100%;
    height: 100%;
    margin-bottom: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    }
    .loader {
    border: 12px solid #fafafa;
    border-radius: 50%;
    border-top: 12px solid hsl(141, 71%, 48%)	;
    width: 100px;
    height: 100px;
    }

    </style>
    <script>const inout = 3;</script>
</head>
<body>
    <section class="hero is-dark">
        <div class="hero-body">
          <div class="container">
            <h1 class="title">
              家計簿
            </h1>
            <h2 class="subtitle is-6" id="balance">
            </h2>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="tabs is-boxed is-mobile is-centered">
            <ul>
              <li>
                <a href="./outside.html">
                  <span>支出</span>
                </a>
              </li>
              <li>
                <a href="./inside.html">
                  <span>収入</span>
                </a>
              </li>
              <li  class="is-active">
                <a>
                  <span>収支</span>
                </a>
              </li>
            </ul>
          </div>
          <div class="loading" id="loading">
            <div class="loader"></div>
            <p>Now loading...</p>
          </div>
        <div class="columns is-mobile is-centered">
            <table class="table">
                <thead>
                    <tr>
                        <th>種類</th>
                        <th>金額</th>
                        <th>日付</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr id="tfoot">
                        <th>収支合計</th>
                    </tr>
                </tfoot>
                <tbody id="tbody">
                </tbody>
            </table>

              </div>            
      </section>
      <script src="./main.js"></script>
      <script>
        var requrl = url+'?inout=3';
        const tbody = document.getElementById('tbody');

        
        var inside_option = refarence.inside;
        var outside_option = refarence.outside;
          
          

        fetch(requrl , {
            method: "GET",
          }).then(response => response.text())
          .then(text => {
            var array = JSON.parse(text);

            let tfoot_color;
            if(Number(array[0])<5000){
              tfoot_color = 'has-text-danger';
            }else{
              tfoot_color = 'has-text-primary';
            }
            let last_price = `<th class="${tfoot_color}">${array[0]}</th><th></th>`;
            document.getElementById('tfoot').insertAdjacentHTML( 'beforeend', last_price);
            var balance = document.getElementById('balance');
            balance.innerText='今月の収支：'+array[0];
            if(Number(array[0])<5000){
              balance.classList.add('has-text-danger');
            }else{
              balance.classList.add('has-text-primary');
            }


            var lim = array.length-2;
            let i =0;
            document.getElementById('loading').remove();

            while(i<lim){
              let type = Number(array[i+2][1]);
              let whitch = Number(array[i+2][0]);
              let detail = array[i+2][2];
              let price = array[i+2][3];
              let date = array[i+2][4];
              if(detail==""){
                if(whitch==1){
                  detail = inside_option[type];
                }else if(whitch==2){
                  detail = outside_option[type];
                }
              }
              if(whitch==1){
                whitch = 'has-text-success';
              }else if(whitch==2){
                price = price*(-1);
                whitch = 'has-text-danger';
              }
              let add_code = `
                    <tr class="${whitch}">
                        <td>${detail}</td>
                        <td>${price}</td>
                        <td>${date}</td>
                    </tr>`;
                    i++
                    tbody.insertAdjacentHTML( 'afterbegin', add_code);
            }
          })//End fetch

          
      </script>
</body>
</html>